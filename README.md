# StoreMarts

Создание витрин данных и перенос данных из систем источников в DWH с помощью pyspark и Airflow <br>

## Задача

Приходят данные для интернет-магазина, который продаёт товары разных категорий (электроника, одежда, книги и т.д.) <br>
Необходимо создать аналитические витрины в Clickhouse <br>

## Системы источники
Данные приходят из разных источников: <br>
Из файловой системы (в виде json, parquet, csv) <br>
Из СУБД (Greenplum, Postgres) <br>

## Целевая система
DWH на основе Clickhouse <br>
4 слоя (raw, ods, dds, data_mart) <br>

## Потребители
BI-разработчики

## Представление данных

Для упрощения понимания представления данных будет представлен список каждой таблицы в raw слое. Всего таблиц 5: <br>
users — информация о пользователях. (Придёт из json файла) <br>
products — информация о продуктах. (Придёт из parquet файла) <br>
orders — информация о заказах. (Придёт из csv файла) <br>
order_items — информация о товарах в заказах. (Придёт из таблицы в Greenplum) <br>
reviews — информация об отзывах на продукты. (Придёт из таблиы в Postgres) <br>

## Связи в будущих таблицах

users.user_id -> orders.user_id <br>
products.product_id -> order_items.product_id <br>
orders.order_id -> order_items.order_id <br>
products.product_id -> reviews.product_id <br>
users.user_id -> reviews.user_id <br>

## Проблемы источников данных

Выявлены проблемы для устранения: <br>
В таблице users встречаются пропуски в колонке country <br> 
В таблице orders встречаются пропуски в колонке payment_method <br>
В таблице reviews встречаются пропуски в колонке review_text <br>
В таблице order_items встречаются пропуски в колонке discount <br>
В таблице products встречаются пропуски в колонке rating <br>
В таблицах orders, order_items и reviews используются случайные значения для внешних ключей <br>
(user_id, product_id, order_id). <br>
Это может привести к тому, что некоторые строки будут ссылаться на несуществующие записи в других таблицах.<br>

## Описание каждой таблицы

### users (информация о пользователях)

user_id (Уникальный идентификатор пользователя) <br>
name (Имя пользователя) <br>
email (Электронная почта пользователя) <br>
registration_date (Дата регистрации пользователя) <br>
country (Страна пользователя) <br>
age	(Возраст пользователя) <br>
last_login (Дата и время последнего входа пользователя) <br>
is_active (Флаг активности пользователя (активен/неактивен)) <br>

### products (информация о продуктах)

product_id (Уникальный идентификатор продукта) <br>
product_name (Название продукта) <br>
category (Категория продукта (например, "Electronics", "Clothing")) <br>
price	(Цена продукта) <br>
created_at (Дата создания записи о продукте) <br>
updated_at (Дата последнего обновления записи о продукте) <br>
is_available (Флаг доступности продукта (доступен/недоступен)) <br>
rating (Рейтинг продукта (может быть NULL)) <br>

### orders (информация о заказах)

order_id (Уникальный идентификатор заказа) <br>
user_id	(Идентификатор пользователя, сделавшего заказ) <br>
order_date (Дата и время оформления заказа) <br>
total_amount (Общая сумма заказа) <br>
status (Статус заказа (например, "Pending", "Shipped", "Delivered", "Cancelled")) <br>
payment_method (Способ оплаты (может быть NULL)) <br>
shipping_address (Адрес доставки) <br>
is_paid (Флаг оплаты заказа (оплачен/не оплачен)) <br>

### order_items (информация о товарах в заказах)

order_item_id	(Уникальный идентификатор товара в заказе) <br>
order_id (Идентификатор заказа) <br>
product_id (Идентификатор продукта) <br>
quantity (Количество товара) <br>
price (Цена товара на момент заказа) <br>
discount (Скидка на товар (может быть NULL)) <br>
created_at (Дата создания записи о товаре в заказе) <br>
updated_at (Дата последнего обновления записи о товаре в заказе) <br>

### reviews (информация об отзывах на продукты)

review_id	(Уникальный идентификатор отзыва) <br>
user_id	(Идентификатор пользователя, оставившего отзыв) <br>
product_id (Идентификатор продукта, на который оставлен отзыв) <br>
rating (Оценка продукта (от 1 до 5)) <br>
review_text (Текст отзыва (может быть NULL)) <br>
review_date	(Дата и время оставления отзыва) <br>
is_approved (Флаг одобрения отзыва (одобрен/не одобрен)) <br>
helpful_votes (Количество голосов "полезно" для отзыва) <br>
